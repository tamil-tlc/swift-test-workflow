name: ci workflow

on:
 push:
  branches:
   - main

jobs:
  lint:
   runs-on: macos-latest

   steps:
    - name: checkout the code 
      uses: actions/checkout@v4

    - name: install swiftlint
      run: brew install swiftlint

    - name: Run swiftlint
      run: swiftlint

  test:
   needs: [lint]
   runs-on: macos-latest
   strategy:
     matrix:
      destination: 
        - platform=iOS Simulater,name=iphone 16,os='18.1'

        
   steps:
    - name: checkout the code
      uses: actions/checkout@v4

    - name: build and test
      run: |
       set -o pipefail
       xcodebuild \
       -project lint-test-ios/lint-test-ios.xcodeproj \
       -scheme  lint-test-ios \
       -destination "${{ matrix.destination }}" \
       -resultbundlepath Testresults-${{ strategy.job-index }} \
       enableCodeCoverage YES \
       CODE_SIGNING_REQUIRED=NO \
       CODE_SIGNING_ALLOWED=NO \
       ONLY_ACTIVE_ARCH=YES \
       | xcpretty --report junit --output test-result.xml
      
